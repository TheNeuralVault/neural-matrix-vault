import*as e from"three";import{EffectComposer as t}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass as i}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass as s}from"three/addons/postprocessing/UnrealBloomPass.js";class NeuralEngine{constructor(){this.canvas=document.getElementById("neural-canvas"),this.renderer=new e.WebGLRenderer({canvas:this.canvas,antialias:!1,powerPreference:"high-performance"}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.scene=new e.Scene,this.scene.fog=new e.FogExp2(0,.03),this.camera=new e.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,2,15),this.mouse=new e.Vector2(0,0),this.targetRot=new e.Vector2(0,0),this.clock=new e.Clock,this.audioLinked=!1,this.analyser=null,this.dataArray=null,this.initLights(),this.initWorld(),this.initPostFX(),this.initEvents(),setTimeout(()=>document.getElementById("loader").style.display="none",800),this.renderer.setAnimationLoop(this.animate.bind(this))}initLights(){let t=new e.AmbientLight(1118481);this.scene.add(t),this.blueLight=new e.PointLight(62463,2,50),this.blueLight.position.set(5,5,5),this.scene.add(this.blueLight),this.pinkLight=new e.PointLight(12325886,2,50),this.pinkLight.position.set(-5,2,-5),this.scene.add(this.pinkLight)}initWorld(){let t=new e.GridHelper(100,100,62463,1118481);t.position.y=-5,this.grid=t,this.scene.add(t);let i=new e.IcosahedronGeometry(2,1),s=new e.MeshBasicMaterial({color:62463,wireframe:!0,transparent:!0,opacity:.3});this.core=new e.Mesh(i,s),this.scene.add(this.core);let n=new e.OctahedronGeometry(1,0),r=new e.MeshStandardMaterial({color:0,emissive:12325886,emissiveIntensity:1});this.innerCore=new e.Mesh(n,r),this.scene.add(this.innerCore);let a=new e.OctahedronGeometry(.05,0),o=new e.MeshBasicMaterial({color:62463});this.swarm=new e.InstancedMesh(a,o,1e3);let h=new e.Object3D;for(let d=0;d<1e3;d++){let c=10+20*Math.random(),$=Math.random()*Math.PI*2,l=(Math.random()-.5)*10;h.position.set(c*Math.cos($),l,c*Math.sin($)),h.updateMatrix(),this.swarm.setMatrixAt(d,h.matrix)}this.scene.add(this.swarm)}initPostFX(){this.composer=new t(this.renderer),this.composer.addPass(new i(this.scene,this.camera)),this.bloom=new s(new e.Vector2(window.innerWidth,window.innerHeight),1.5,.4,.85),this.bloom.strength=1.2,this.composer.addPass(this.bloom)}async connectAudio(){try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new(window.AudioContext||window.webkitAudioContext),i=t.createMediaStreamSource(e);this.analyser=t.createAnalyser(),this.analyser.fftSize=64,i.connect(this.analyser),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.audioLinked=!0;let s=document.getElementById("mic-trigger");s.innerText="[ NEURAL LINK ACTIVE ]",s.classList.add("active")}catch(n){console.warn("Mic Denied",n),alert("MIC ACCESS DENIED. VISUALS WILL REMAIN STATIC.")}}initEvents(){window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.composer.setSize(window.innerWidth,window.innerHeight)}),window.addEventListener("mousemove",e=>{this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-(2*(e.clientY/window.innerHeight))+1}),document.getElementById("init-btn").addEventListener("click",()=>{document.getElementById("landing-layer").style.display="none",document.getElementById("dashboard-layer").style.display="block",document.getElementById("dashboard-layer").classList.add("active-layer"),this.targetCameraZ=10}),document.getElementById("mic-trigger").addEventListener("click",()=>{this.connectAudio()}),this.targetCameraZ=15}animate(){let e=this.clock.getElapsedTime(),t=0;this.audioLinked&&this.analyser&&(this.analyser.getByteFrequencyData(this.dataArray),t=this.dataArray[0]/255);let i=1+.5*t;this.innerCore.scale.set(i,i,i),this.bloom.strength=1.2+2*t,this.core.rotation.y=.2*e+.1*t,this.grid.position.z=2*e%10,this.swarm.rotation.y=.05*e,this.targetRot.x+=(.5*this.mouse.y-this.targetRot.x)*.05,this.targetRot.y+=(.5*this.mouse.x-this.targetRot.y)*.05,this.camera.rotation.x=.2*this.targetRot.x,this.camera.rotation.y=.2*this.targetRot.y,this.camera.position.z+=(this.targetCameraZ-this.camera.position.z)*.05,this.composer.render()}}new NeuralEngine;
